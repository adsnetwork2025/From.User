<!DOCTYPE html>
<html>
<head>
  <title>Colour Trading - User</title>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #aaa; }
    button, input, select { width: 100%; margin: 8px 0; padding: 10px; }
    .green { background: green; color: white; }
    .red { background: red; color: white; }
    .copy-btn { background: #007bff; color: white; }
    .result { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
<div class="container">
  <h2>Colour Trading</h2>

  <label><strong>User ID:</strong> <span id="userIdDisplay"></span></label>
  <div><strong>Balance:</strong> ৳<span id="balance">0</span></div>

  <button class="green" onclick="selectColor('green')">Green</button>
  <button class="red" onclick="selectColor('red')">Red</button>

  <input type="number" id="betAmount" placeholder="Enter Bet Amount">
  <button onclick="placeBet()">Bet</button>
  <div class="result" id="betResult"></div>

  <hr>
  <h3>Deposit</h3>
  <select id="method">
    <option value="">Select Method</option>
    <option value="bkash">Bkash</option>
    <option value="nagad">Nagad</option>
  </select>

  <div id="copyBox" style="display: none;">
    <div style="display: flex; justify-content: space-between;">
      <span id="methodNumber">01XXXXXXXXX</span>
      <button class="copy-btn" onclick="copyNumber()">Copy</button>
    </div>
  </div>

  <input type="number" id="depositAmount" placeholder="Enter Amount">
  <input type="text" id="trxId" placeholder="Transaction ID">
  <button onclick="submitDeposit()">Submit Deposit</button>
  <div class="result" id="depositMsg"></div>

  <hr>
  <h3>Withdraw</h3>
  <button onclick="showWithdrawForm()">Withdraw</button>

  <div id="withdrawForm" style="display: none;">
    <select id="withdrawMethod">
      <option value="">Select Method</option>
      <option value="bkash">Bkash</option>
      <option value="nagad">Nagad</option>
    </select>
    <input type="text" id="accountNumber" placeholder="Account Number">
    <input type="number" id="withdrawAmount" placeholder="Enter Amount (Min 500)">
    <button onclick="submitWithdraw()">Submit Withdraw</button>
    <div class="result" id="withdrawMsg"></div>
  </div>
</div>

<script>
  // === USER SETUP ===
  const userId = prompt("Enter your UID:"); // You can generate or input dynamically
  document.getElementById("userIdDisplay").innerText = userId;

  // Use per-user localStorage key
  let balanceKey = `balance_${userId}`;
  let balance = parseInt(localStorage.getItem(balanceKey)) || 0;

  document.getElementById("balance").innerText = balance;

  function updateBalanceDisplay() {
    document.getElementById("balance").innerText = balance;
    localStorage.setItem(balanceKey, balance);
  }

  // === BET SECTION ===
  let lastBet = 0;
  let selectedColor = "";
  let hasBet = false;

  function selectColor(color) {
    selectedColor = color;
    document.getElementById("betResult").innerText = `Selected: ${color.toUpperCase()}`;
  }

  function placeBet() {
    let amount = parseInt(document.getElementById("betAmount").value);
    if (!selectedColor || isNaN(amount) || amount <= 0) {
      alert("Select color and enter valid amount.");
      return;
    }

    if (amount > balance) {
      alert("Insufficient balance.");
      return;
    }

    balance -= amount;
    updateBalanceDisplay();
    document.getElementById("betResult").innerText = "Betting... wait 10 seconds";

    setTimeout(() => {
      let win = false;
      if (!hasBet) win = true;
      else if (amount > lastBet) win = false;
      else win = Math.random() < 0.5;

      if (win) {
        let reward = amount * 2;
        balance += reward;
        document.getElementById("betResult").innerText = `You WON! ৳${reward}`;
      } else {
        document.getElementById("betResult").innerText = "You LOST!";
      }

      hasBet = true;
      lastBet = amount;
      updateBalanceDisplay();
    }, 10000);
  }

  // === DEPOSIT SECTION ===
  document.getElementById("method").addEventListener("change", function() {
    const val = this.value;
    const copyBox = document.getElementById("copyBox");
    const number = val === "bkash" ? "01750631170" : "01YYYYYYYYY";
    if (val) {
      copyBox.style.display = "block";
      document.getElementById("methodNumber").innerText = number;
    } else {
      copyBox.style.display = "none";
    }
  });

  function copyNumber() {
    const text = document.getElementById("methodNumber").innerText;
    navigator.clipboard.writeText(text).then(() => alert("Copied: " + text));
  }

  function submitDeposit() {
    const method = document.getElementById("method").value;
    const amount = parseInt(document.getElementById("depositAmount").value);
    const trx = document.getElementById("trxId").value;

    if (!method || !amount || !trx) {
      document.getElementById("depositMsg").style.color = "red";
      document.getElementById("depositMsg").innerText = "Fill all fields!";
      return;
    }

    const depositData = JSON.parse(localStorage.getItem("depositRequests") || "[]");
    depositData.push({ id: Date.now(), userId, method, amount, trx });
    localStorage.setItem("depositRequests", JSON.stringify(depositData));

    document.getElementById("depositMsg").style.color = "green";
    document.getElementById("depositMsg").innerText = "Submitted! Waiting for admin.";
    document.getElementById("depositAmount").value = '';
    document.getElementById("trxId").value = '';
  }

  // === WITHDRAW SECTION ===
  function showWithdrawForm() {
    document.getElementById("withdrawForm").style.display = "block";
  }

  function submitWithdraw() {
    const method = document.getElementById("withdrawMethod").value;
    const accountNumber = document.getElementById("accountNumber").value;
    const withdrawAmount = parseInt(document.getElementById("withdrawAmount").value);

    if (!method || !accountNumber || isNaN(withdrawAmount) || withdrawAmount < 500) {
      document.getElementById("withdrawMsg").style.color = "red";
      document.getElementById("withdrawMsg").innerText = "Please fill all fields and ensure amount is minimum 500.";
      return;
    }

    if (withdrawAmount > balance) {
      document.getElementById("withdrawMsg").style.color = "red";
      document.getElementById("withdrawMsg").innerText = "Insufficient balance.";
      return;
    }

    balance -= withdrawAmount;
    updateBalanceDisplay();

    document.getElementById("withdrawMsg").style.color = "green";
    document.getElementById("withdrawMsg").innerText = `Withdrawal of ৳${withdrawAmount} is successful!`;

    document.getElementById("withdrawMethod").value = '';
    document.getElementById("accountNumber").value = '';
    document.getElementById("withdrawAmount").value = '';
    document.getElementById("withdrawForm").style.display = "none";
  }
</script>
</body>
</html>
